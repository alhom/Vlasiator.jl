<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Guide · Vlasiator.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://henry2004y.github.io/Vlasiator.jl/examples/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Vlasiator.jl logo"/></a><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>User Guide</a><ul class="internal"><li><a class="tocitem" href="#Loading-VLSV-data"><span>Loading VLSV data</span></a></li><li><a class="tocitem" href="#Computing-derived-quantities"><span>Computing derived quantities</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#Converting-to-VTK"><span>Converting to VTK</span></a></li><li><a class="tocitem" href="#Tracking-log-files"><span>Tracking log files</span></a></li><li><a class="tocitem" href="#Calling-from-Python"><span>Calling from Python</span></a></li></ul></li><li><a class="tocitem" href="../internal/">API Reference</a></li><li><a class="tocitem" href="../log/">Log</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>User Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/henry2004y/Vlasiator.jl/blob/master/docs/src/examples.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="Loading-VLSV-data"><a class="docs-heading-anchor" href="#Loading-VLSV-data">Loading VLSV data</a><a id="Loading-VLSV-data-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-VLSV-data" title="Permalink"></a></h2><ul><li>Read meta data</li></ul><pre><code class="nohighlight">filename = &quot;bulk.0000004.vlsv&quot;
meta = readmeta(filename)</code></pre><p>This VLSV meta data contains information of file names, variable names, cell ID list, mesh sizes and populations, which can then be passed into all kinds of methods that process the data. </p><ul><li>Read variable meta data</li></ul><pre><code class="nohighlight">readvariablemeta(meta, &quot;proton/vg_rho&quot;)</code></pre><p>A list of utility functions has been implemented for checking variable status. See <a href="https://henry2004y.github.io/Vlasiator.jl/dev/internal/#Vlasiator.hasname-Tuple{Any,%20Any,%20Any}">here</a> for the full list. </p><ul><li>Read variable</li></ul><pre><code class="nohighlight">data = readvariable(meta, &quot;proton/vg_rho&quot;)</code></pre><p>The variable reading is designed for cells, which takes cell ID(s) as inputs, although the same interface works for both DCCRG grid and FS grid variables. By default the returned DCCRG grid variable array is sorted by cell IDs. If in any case you want the original unsorted version as being stored in the file, use <code>readvariable(meta, var, false)</code>.</p><ul><li>Get variable at a given location</li></ul><pre><code class="nohighlight">loc = [2.0, 0.0, 0.0]
id = getcell(meta, loc)
readvariable(meta, &quot;proton/vg_rho&quot;, id)</code></pre><ul><li>Get variable along a line between two points</li></ul><pre><code class="nohighlight">point1 = [12Re, 0, 0]
point2 = [15Re, 0, 0]
cellids, distances, coords = getcellinline(meta, point1, point2)
readvariable(meta, &quot;proton/vg_rho&quot;, cellids)</code></pre><ul><li>Compare VLSV files</li></ul><p>One may want to check if two vlsv files are identical. This is tricky because</p><ol><li>the structure of VLSV format does not guarantee parallel writing order;</li><li>numerical error accumulates with floating point representation.</li></ol><p>The key is that we should not check quantities that are related to MPI writing sequence: for some reasons, even file sizes may vary depending on the number of MPI processes!</p><pre><code class="nohighlight">vlsvdiff(filename1, filename2)</code></pre><p>There is an optional third argument to <code>vlsvdiff</code> for setting the relative difference tolerance, with default being 1e-4. In practice relative difference works better for &quot;large&quot; numbers, and absolute difference works better for &quot;small&quot; numbers.</p><p>More examples can be found in the <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/examples">repo</a>.</p><h2 id="Computing-derived-quantities"><a class="docs-heading-anchor" href="#Computing-derived-quantities">Computing derived quantities</a><a id="Computing-derived-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-derived-quantities" title="Permalink"></a></h2><p>Vlasiator is capable of computing moments and some derived quantities and save them directly into VLSV files. More derived quantities computed from the saved quantities are also available in postprocessing, such as plasma β, velocity parallel/perpendicular to the magnetic field, pressure tensor with the third axis aligned with the magnetic field direction and so on. To avoid confusion about variable names, the convention here is that</p><ul><li>if it is directly stored in the VLSV file, read the raw data;</li><li>otherwise check the availability in the derived variable list. All predefined names start with a capital letter.</li></ul><p>To obtain a derived quantity, for example,</p><pre><code class="nohighlight">beta = readvariable(meta, &quot;Beta&quot;)</code></pre><p>Here is a full list of available quantities<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>:</p><table><tr><th style="text-align: right">Derived variable name</th><th style="text-align: right">Meaning</th><th style="text-align: right">Required variable<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></th></tr><tr><td style="text-align: right">Bmag</td><td style="text-align: right">magnetic field magnitude</td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Emag</td><td style="text-align: right">electric field magnitude</td><td style="text-align: right">vg_e_vol</td></tr><tr><td style="text-align: right">Vmag</td><td style="text-align: right">bulk speed</td><td style="text-align: right">vg_v</td></tr><tr><td style="text-align: right">VS</td><td style="text-align: right">sound speed</td><td style="text-align: right">vg_ptensor_diagonal; vg_rho</td></tr><tr><td style="text-align: right">VA</td><td style="text-align: right">Alfvén speed</td><td style="text-align: right">vg_rho; Bmag</td></tr><tr><td style="text-align: right">MA</td><td style="text-align: right">Alfvén Mach number</td><td style="text-align: right">Vmag; VA</td></tr><tr><td style="text-align: right">Vpar</td><td style="text-align: right">bulk velocity <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_v; vg_b_vol</td></tr><tr><td style="text-align: right">Vperp</td><td style="text-align: right">bulk velocity <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_v; vg_b_vol</td></tr><tr><td style="text-align: right">P</td><td style="text-align: right">scalar thermal pressure</td><td style="text-align: right">vg_ptensor_diagonal</td></tr><tr><td style="text-align: right">Ppar</td><td style="text-align: right">pressure <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_ptensor_diagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Pperp</td><td style="text-align: right">pressure <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_ptensor_offdiagonal; vg_b_vol</td></tr><tr><td style="text-align: right">T</td><td style="text-align: right">scalar temperature</td><td style="text-align: right">P; vg_rho</td></tr><tr><td style="text-align: right">Tpar</td><td style="text-align: right">temperature <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_rho; vg_ptensor_diagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Tperp</td><td style="text-align: right">temperature <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_rho; vg_ptensor_offdiagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Protated</td><td style="text-align: right">pressure tensor with <span>$\widehat{z} \parallel \mathbf{B}$</span></td><td style="text-align: right">vg_b_vol; vg_ptensor_diagonal; vg_ptensor_offdiagonal</td></tr><tr><td style="text-align: right">Anisotropy</td><td style="text-align: right"><span>$P_\perp / P_\parallel$</span></td><td style="text-align: right">ptensor; B</td></tr><tr><td style="text-align: right">Pdynamic</td><td style="text-align: right">dynamic pressure</td><td style="text-align: right">vg_rho; Vmag</td></tr><tr><td style="text-align: right">Poynting</td><td style="text-align: right">Poynting flux</td><td style="text-align: right">E; B</td></tr><tr><td style="text-align: right">Beta</td><td style="text-align: right">plasma beta, <span>$P / P_B$</span></td><td style="text-align: right">P; vg_b_vol</td></tr><tr><td style="text-align: right">IonInertial</td><td style="text-align: right">ion inertial length</td><td style="text-align: right">vg_rho</td></tr><tr><td style="text-align: right">Larmor</td><td style="text-align: right">Larmor radius</td><td style="text-align: right">Vperp; Bmag</td></tr><tr><td style="text-align: right">Gyrofrequency</td><td style="text-align: right">ion gyroperiod</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">Plasmaperiod</td><td style="text-align: right">plasma oscillation period</td><td style="text-align: right"></td></tr></table><p>which can also be found as keys of dictionary in <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/src/vlsv/vlsvvariables.jl">vlsvvariables.jl</a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In Vlasiator, the cells inside the inner boundary (which is usually a sphere/circle) are filled with zero density values. This is then used to identify the inner boundary for all other quantities. Therefore, if you are manipulating directly on data, make sure that the nonsense values inside the inner boundary are excluded. One way to do this can be found in <a href="https://github.com/henry2004y/Vlasiator.jl/blob/master/src/vlsv/vlsvvariables.jl">vlsvvariables.jl</a>.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This part has not been carefully tested so it might not work or just generate wrong results. Contributions from users are warmly welcomed!</p></div></div><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><p>Vlasiator.jl does not include any plotting library as explicit dependency, but it offers plotting functionalities once the target plotting package is used.</p><p>Currently I would recommend using <code>PyPlot.jl</code>. <code>Plots.jl</code> is catching up, but it is still slower and lack of features. <code>Makie.jl</code> will be supported in the future if 3D plotting is necessary.</p><p>More examples of customized plots can be found in the <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/src/examples">repo</a>.</p><h3 id="PyPlot-Backend"><a class="docs-heading-anchor" href="#PyPlot-Backend">PyPlot Backend</a><a id="PyPlot-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#PyPlot-Backend" title="Permalink"></a></h3><p>To trigger the Matplotlib plotting, <code>using PyPlot</code>. All the functions with identical names as in Matplotlib accept all possible keyword arguments supported by their Matplotlib counterparts, e.g. font width, font size, colormap, etc.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The method call to certain axes is not dispatched, e.g. <code>ax.plot</code>; as an alternative, one needs to pass <code>ax</code> as the third argument to the functions, e.g. <code>plot(meta, &quot;rho&quot;, ax)</code>!</p></div></div><ul><li>Scalar colored contour for 2D simulation</li></ul><pre><code class="nohighlight">pcolormesh(meta, &quot;rho&quot;)</code></pre><ul><li>Vector z component colored contour for 2D simulation in a manually set range</li></ul><pre><code class="nohighlight">pcolormesh(meta, &quot;rho&quot;, op=:z, colorscale=Log, axisunit=RE, vmin=1e6, vmax=2e6)</code></pre><ul><li>Derived quantity colored contour for 2D simulation (as long as the input variable is in the predefined dictionary)</li></ul><pre><code class="nohighlight">pcolormesh(meta, &quot;b&quot;, op=:z, colorscale=Linear, axisunit=SI)</code></pre><ul><li>Streamline for 2D simulation</li></ul><pre><code class="nohighlight">streamplot(meta, &quot;rho_v&quot;, comp=&quot;xy&quot;)</code></pre><ul><li>Quiver for 2D simulation</li></ul><pre><code class="nohighlight">quiver(meta, &quot;rho_v&quot;, comp=&quot;xy&quot;)</code></pre><p>The <code>comp</code> option is used to specify the two vector components.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Currently there is limited support for derived variables. This will be expanded and changed later for ease of use!</p></div></div><p>You can choose to use linear/log color scale via <code>colorscale=Linear</code> or <code>colorscale=Log</code>, plot vector components via e.g. <code>op=:x</code> or magnitude by default, and set unit via <code>axisunit=RE</code> etc..</p><ul><li>Mesh denoted by cell centers</li></ul><pre><code class="nohighlight">plotmesh(meta; projection=&quot;z&quot;, color=&quot;w&quot;)</code></pre><ul><li>Cut slice colored contour for 3D simulation</li></ul><pre><code class="nohighlight">pcolormesh(meta, &quot;proton/vg_rho&quot;, normal=:y, origin=0.0)</code></pre><ul><li>Velocity distribution function near a given spatial location <code>coordinates = [0.0, 0.0, 0.0]</code></li></ul><pre><code class="nohighlight">plot_vdf(meta, coordinates)</code></pre><h3 id="Plots-Backend"><a class="docs-heading-anchor" href="#Plots-Backend">Plots Backend</a><a id="Plots-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#Plots-Backend" title="Permalink"></a></h3><p>To trigger the Plots package plotting, <code>using Plots</code>. This backend supports all available attributes provided by <a href="http://docs.juliaplots.org/latest/">Plots.jl</a>. By default it uses <a href="https://gr-framework.org/">GR</a>, but a wide range of other options are also presented.</p><ul><li>Scaler colored contour for 2D simulation</li></ul><pre><code class="nohighlight">heatmap(meta, &quot;rho&quot;, aspect_ratio=:equal, c=:turbo)</code></pre><ul><li>Scaler colored contour with lines for 2D simulation</li></ul><pre><code class="nohighlight">contourf(meta, &quot;rho)</code></pre><h3 id="Gallery"><a class="docs-heading-anchor" href="#Gallery">Gallery</a><a id="Gallery-1"></a><a class="docs-heading-anchor-permalink" href="#Gallery" title="Permalink"></a></h3><ul><li>Proton density in advection flow with points denoting cell centers</li></ul><p><img src="../figures/mesh.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the meridional plane from 3D simulation</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_ycut.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the equatorial plane from 2D simulation, zoomed in to the magnetosheath and foreshock region, with streamlines and density contour at 1e7</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_2D.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the meridional cut from 2D simulation, with fieldlines through fixed seeding points</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_2D_bx_bz.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the normal cut planes from 3D simulation</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_3cuts.png" alt/></p><ul><li>Proton phase space distribution</li></ul><p><img src="../figures/phase_space_distribution.png" alt/></p><h2 id="Converting-to-VTK"><a class="docs-heading-anchor" href="#Converting-to-VTK">Converting to VTK</a><a id="Converting-to-VTK-1"></a><a class="docs-heading-anchor-permalink" href="#Converting-to-VTK" title="Permalink"></a></h2><p>We can convert VLSV files into VTK files! Since DCCRG is Cartesian based with uniform spacing, each level of refinement corresponds to a VTK image file, and the cell refinement relationships are defined by <code>vtkGhostType</code> as well as the <code>vthb</code> file.</p><p>To convert a VLSV file into VTK,</p><pre><code class="nohighlight">write_vtk(filename)</code></pre><p>This function accepts both file names and file meta.</p><p>To see the full list of options, please refer to the documentation in <a href="../internal/">internal</a>. Demo usage can be found <a href="https://github.com/henry2004y/Vlasiator.jl/blob/master/examples/demo_convert2vti.jl">here</a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>As of ParaView 5.9.1, there are <a href="https://discourse.paraview.org/t/vthb-file-structure/7224">display issues</a> with <code>VTKOverlappingAMR</code>. However, we can read the generated image files directly. There is also an keyword argument for <code>write_vtk</code> called <code>vti</code>: when it is set to <code>true</code>, then only the image file at the highest refinement level is generated. This part is experimental and subject to change in the future.</p></div></div><h2 id="Tracking-log-files"><a class="docs-heading-anchor" href="#Tracking-log-files">Tracking log files</a><a id="Tracking-log-files-1"></a><a class="docs-heading-anchor-permalink" href="#Tracking-log-files" title="Permalink"></a></h2><p>We can monitor the runtime performance per iteration through log files:</p><pre><code class="nohighlight">file = &quot;logfile.txt&quot;
timestamps, speed = readlog(file)</code></pre><p>See a live example at <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/examples/demo_log.jl">demo_log.jl</a>.</p><h2 id="Calling-from-Python"><a class="docs-heading-anchor" href="#Calling-from-Python">Calling from Python</a><a id="Calling-from-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Calling-from-Python" title="Permalink"></a></h2><p>It is possible to call this package directly from Python with the aid of <a href="https://pyjulia.readthedocs.io/en/latest/">PyJulia</a>. Following the installation steps described in the manual<sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup>, and then inside Python REPL:</p><pre><code class="nohighlight"># Handling initialization issue for Conda
from julia.api import Julia
jl = Julia(compiled_modules=False)

from julia import Vlasiator
filename = &quot;bulk1.0001000.vlsv&quot;
meta = Vlasiator.readmeta(filename)
var = &quot;proton/vg_rho&quot;
data = Vlasiator.readvariable(meta, var)</code></pre><p>To run a Julia script in Python,</p><pre><code class="nohighlight"># Handling initialization issue for Conda
from julia.api import Julia
jl = Julia(compiled_modules=False)
jl.eval(&#39;include(&quot;examples/demo_2dplot_pyplot.jl&quot;)&#39;)
import matplotlib.pyplot as plt
plt.show()</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This approach is for you to have a taste of the package with a Python frontend. The workaround shown above for handling the static python libraries makes it slow for regular use. An alternative solution would be creating system images, but as of Julia 1.6 the user experience is not smooth. For better integrated experience with its full power, I recommend using the package inside Julia.</p></div></div><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>For species specific variables, you need to add the species name at the front, separated by a slash. For example, the proton bulk velocity is a string <code>proton/vg_v</code>.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>If a required variable exists in the VLSV file, we try to use it directly instead of calculating from other variables. The interpolated FS grid variables onto DCCRG grid are preferred over original FS grid variables.</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>For Debian-based Linux distributions, it gets a little bit tricky. Please refer to <a href="https://pyjulia.readthedocs.io/en/latest/troubleshooting.html">Troubleshooting</a> for details.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../internal/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.3 on <span class="colophon-date" title="Saturday 10 July 2021 06:56">Saturday 10 July 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
