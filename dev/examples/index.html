<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example · Vlasiator.jl</title><link rel="canonical" href="https://henry2004y.github.io/Vlasiator.jl/examples/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Vlasiator.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Example</a><ul class="internal"><li><a class="tocitem" href="#Loading-VLSV-data"><span>Loading VLSV data</span></a></li><li><a class="tocitem" href="#Computing-derived-quantities"><span>Computing derived quantities</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#Calling-from-Python"><span>Calling from Python</span></a></li><li><a class="tocitem" href="#Misc"><span>Misc</span></a></li></ul></li><li><a class="tocitem" href="../internal/">Internal</a></li><li><a class="tocitem" href="../log/">Log</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/henry2004y/Vlasiator.jl/blob/master/docs/src/examples.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="Loading-VLSV-data"><a class="docs-heading-anchor" href="#Loading-VLSV-data">Loading VLSV data</a><a id="Loading-VLSV-data-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-VLSV-data" title="Permalink"></a></h2><ul><li>Read meta data</li></ul><pre><code class="language-none">filename = &quot;bulk.0000004.vlsv&quot;
meta = readmeta(filename)</code></pre><ul><li>Display all variable names</li></ul><pre><code class="language-none">vars = showvariables(meta)</code></pre><ul><li>Read variable</li></ul><pre><code class="language-none">data = readvariable(meta, &quot;proton/vg_rho&quot;)</code></pre><p>The same interface works for both DCCRG grid and FS grid variables. By default the returned DCCRG grid variable array is sorted by cell IDs. If in any case you want the original unsorted version as being stored in the file, simply say <code>readvariable(meta, var, false)</code>.</p><ul><li>Get variable at a given location (This can be simplified even further later!)</li></ul><pre><code class="language-none">loc = [2.0, 0.0, 0.0]
id = getcell(meta, loc)
readvariable(meta, &quot;proton/vg_rho&quot;, id)</code></pre><ul><li>Get variable along a line between two points</li></ul><pre><code class="language-none">point1 = [12Re, 0, 0]
point2 = [15Re, 0, 0]
cellids, distances, coords = getcellinline(meta, point1, point2)</code></pre><p>Combined with external packages like <a href="https://github.com/henry2004y/FieldTracer.jl">FieldTracer.jl</a>, it is possible to do all kinds of in-depth analysis. More examples can be found in the <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/src/examples">repo</a>.</p><h2 id="Computing-derived-quantities"><a class="docs-heading-anchor" href="#Computing-derived-quantities">Computing derived quantities</a><a id="Computing-derived-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-derived-quantities" title="Permalink"></a></h2><p>Vlasiator is capable of computing moments and some derived quantities and save them directly into VLSV files. More derived quantities computed from the saved quantities are also available in postprocessing, such as plasma β, velocity parallel/perpendicular to the magnetic field, pressure tensor with the third axis aligned with the magnetic field direction and so on. To avoid confusion about variable names, the convention here is that</p><ul><li>if it is directly stored in the VLSV file, read the raw data;</li><li>otherwise check the availability in the derived variable list. All predefined names start with a capital letter.</li></ul><p>To obtain a derived quantity, for example,</p><pre><code class="language-none">beta = readvariable(meta, &quot;Beta&quot;)</code></pre><p>Here is a full list of available quantities<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>:</p><table><tr><th style="text-align: right">Derived variable name</th><th style="text-align: right">Meaning</th><th style="text-align: right">Required variable<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></th></tr><tr><td style="text-align: right">Bmag</td><td style="text-align: right">magnetic field magnitude</td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Emag</td><td style="text-align: right">electric field magnitude</td><td style="text-align: right">vg_e_vol</td></tr><tr><td style="text-align: right">Vmag</td><td style="text-align: right">bulk speed</td><td style="text-align: right">vg_v</td></tr><tr><td style="text-align: right">VS</td><td style="text-align: right">sound speed</td><td style="text-align: right">vg_ptensor_diagonal; vg_rho</td></tr><tr><td style="text-align: right">VA</td><td style="text-align: right">Alfvén speed</td><td style="text-align: right">vg_rho; Bmag</td></tr><tr><td style="text-align: right">MA</td><td style="text-align: right">Alfvén Mach number</td><td style="text-align: right">Vmag; VA</td></tr><tr><td style="text-align: right">Vpar</td><td style="text-align: right">bulk velocity <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_v; vg_b_vol</td></tr><tr><td style="text-align: right">Vperp</td><td style="text-align: right">bulk velocity <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_v; vg_b_vol</td></tr><tr><td style="text-align: right">P</td><td style="text-align: right">scalar thermal pressure</td><td style="text-align: right">vg_ptensor_diagonal</td></tr><tr><td style="text-align: right">T</td><td style="text-align: right">scalar temperature</td><td style="text-align: right">P; vg_rho</td></tr><tr><td style="text-align: right">Tpar</td><td style="text-align: right">temperature <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_rho; vg_ptensor_diagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Tperp</td><td style="text-align: right">temperature <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_rho; vg_ptensor_offdiagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Protated</td><td style="text-align: right">pressure tensor with <span>$\widehat{z} \parallel \mathbf{B}$</span></td><td style="text-align: right">vg_b_vol; vg_ptensor_diagonal; vg_ptensor_offdiagonal</td></tr><tr><td style="text-align: right">Anisotropy</td><td style="text-align: right"><span>$P_\perp / P_\parallel$</span></td><td style="text-align: right">ptensor; B</td></tr><tr><td style="text-align: right">Pdynamic</td><td style="text-align: right">dynamic pressure</td><td style="text-align: right">vg_rho; Vmag</td></tr><tr><td style="text-align: right">Poynting</td><td style="text-align: right">Poynting flux</td><td style="text-align: right">E; B</td></tr><tr><td style="text-align: right">Beta</td><td style="text-align: right">plasma beta, <span>$P / P_B$</span></td><td style="text-align: right">P; vg_b_vol</td></tr><tr><td style="text-align: right">IonInertial</td><td style="text-align: right">ion inertial length</td><td style="text-align: right">vg_rho</td></tr><tr><td style="text-align: right">Larmor</td><td style="text-align: right">Larmor radius</td><td style="text-align: right">Vperp; Bmag</td></tr><tr><td style="text-align: right">Gyrofrequency</td><td style="text-align: right">ion gyroperiod</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">Plasmaperiod</td><td style="text-align: right">plasma oscillation period</td><td style="text-align: right"></td></tr></table><p>which can also be found as keys of dictionary in <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/src/vlsv/vlsvvariables.jl">vlsvvariables.jl</a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>This part has not been carefully tested so it might not work or just generate wrong results!</p></div></div><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><p>Vlasiator.jl does not include any plotting library as explicit dependency, but it offers plotting functionalities once the target plotting package is used.</p><p>Currently I would recommend using <code>PyPlot.jl</code>. <code>Plots.jl</code> is catching up, but it is still slower and lack of features. <code>Makie.jl</code> will be supported in the future if 3D plotting is necessary.</p><p>More examples of customized plots can be found in the <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/src/examples">repo</a>.</p><h3 id="PyPlot-Backend"><a class="docs-heading-anchor" href="#PyPlot-Backend">PyPlot Backend</a><a id="PyPlot-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#PyPlot-Backend" title="Permalink"></a></h3><p>To trigger the Matplotlib plotting, <code>using PyPlot</code>. All the functions with identical names as in Matplotlib accepts all possible keyword arguments.</p><ul><li>Scalar colored contour for 2D simulation</li></ul><pre><code class="language-none">plot_pcolormesh(meta, &quot;rho&quot;)</code></pre><ul><li>Vector z component colored contour for 2D simulation in a manually set range</li></ul><pre><code class="language-none">plot_pcolormesh(meta, &quot;rho&quot;, op=:z, islinear=false, axisunit=&quot;Re&quot;, vmin=1e6, vmax=2e6)</code></pre><ul><li>Derived quantity colored contour for 2D simulation (as long as the input variable is in the predefined dictionary)</li></ul><pre><code class="language-none">plot_pcolormesh(meta, &quot;b&quot;, op=:z, islinear=false, axisunit=&quot;Re&quot;)</code></pre><ul><li>Streamline for 2D simulation</li></ul><pre><code class="language-none">streamline(meta, &quot;rho_v&quot;, comp=&quot;xy&quot;)</code></pre><p>The <code>comp</code> option is used to specify the two vector components.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Currently there is limited support for derived variables. This will be expanded and changed later for ease of use!</p></div></div><p>You can choose to use linear/log color scale, plot vector components via e.g. <code>op=:x</code> or magnitude by default, and set unit via <code>axisunit=&quot;Re&quot;</code> etc..</p><ul><li>Cut slice colored contour for 3D simulation</li></ul><pre><code class="language-none">plot_colormap3dslice(meta, &quot;proton/vg_rho&quot;, normal=:y)</code></pre><ul><li>Velocity distribution function near a given spatial location <code>coordinates = [0.0, 0.0, 0.0]</code></li></ul><pre><code class="language-none">plot_vdf(meta, coordinates)</code></pre><h3 id="Plots-Backend"><a class="docs-heading-anchor" href="#Plots-Backend">Plots Backend</a><a id="Plots-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#Plots-Backend" title="Permalink"></a></h3><p>To trigger the Plots package plotting, <code>using Plots</code>. This backend supports all available attributes provided by <a href="http://docs.juliaplots.org/latest/">Plots.jl</a>.</p><ul><li>Scaler colored contour for 2D simulation</li></ul><pre><code class="language-none">heatmap(meta, &quot;rho&quot;, aspect_ratio=:equal, c=:turbo)</code></pre><ul><li>Scaler colored contour with lines for 2D simulation</li></ul><pre><code class="language-none">contourf(meta, &quot;rho)</code></pre><h3 id="Gallery"><a class="docs-heading-anchor" href="#Gallery">Gallery</a><a id="Gallery-1"></a><a class="docs-heading-anchor-permalink" href="#Gallery" title="Permalink"></a></h3><ul><li>Proton density of Earth&#39;s magnetosphere in the meridional plane from 3D simulation</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_ycut.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the equatorial plane from 2D simulation, zoomed in to the magnetosheath and foreshock region, with streamlines and density contour at 1e7</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_2D.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the meridional cut from 2D simulation, with fieldlines through fixed seeding points</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_2D_bx_bz.png" alt/></p><ul><li>Proton density of Earth&#39;s magnetosphere in the normal cut planes from 3D simulation</li></ul><p><img src="../figures/magnetosphere_earth_proton_density_3cuts.png" alt/></p><ul><li>Proton phase space distribution</li></ul><p><img src="../figures/phase_space_distribution.png" alt/></p><h2 id="Calling-from-Python"><a class="docs-heading-anchor" href="#Calling-from-Python">Calling from Python</a><a id="Calling-from-Python-1"></a><a class="docs-heading-anchor-permalink" href="#Calling-from-Python" title="Permalink"></a></h2><p>It is possible to call this package directly from Python with the aid of <a href="https://pyjulia.readthedocs.io/en/latest/">PyJulia</a>. Following the installation steps described in the manual<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>, and then inside Python REPL:</p><pre><code class="language-none"># Handling initialization issue for Conda
from julia.api import Julia
jl = Julia(compiled_modules=False)

from julia import Vlasiator
filename = &quot;bulk1.0001000.vlsv&quot;
meta = Vlasiator.readmeta(filename)
var = &quot;proton/vg_rho&quot;
data = Vlasiator.readvariable(meta, var)</code></pre><p>To run a Julia script in Python,</p><pre><code class="language-none"># Handling initialization issue for Conda
from julia.api import Julia
jl = Julia(compiled_modules=False)
jl.eval(&#39;include(&quot;src/examples/demo_2dplot_pyplot.jl&quot;)&#39;)
import matplotlib.pyplot as plt
plt.show()</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This approach is for you to have a taste of the package. For better integrated experience with its full power, I recommend using the package inside Julia.</p></div></div><h2 id="Misc"><a class="docs-heading-anchor" href="#Misc">Misc</a><a id="Misc-1"></a><a class="docs-heading-anchor-permalink" href="#Misc" title="Permalink"></a></h2><p>One may want to check if two vlsv files are identical. This is tricky because</p><ol><li>the structure of VLSV format does not guarantee parallel writing order;</li><li>numerical error accumulates with floating point representation.</li></ol><p>The key is that we should not check quantities that are related to MPI writing sequence. Note that even file sizes may vary depending on the number of MPI processes!</p><pre><code class="language-none">compare(filename1, filename2)</code></pre><p>There is an optional third argument to <code>compare</code> for setting the relative difference tolerance, with default being 1e-4. In practice relative difference works better for &quot;large&quot; numbers, and absolute difference works better for &quot;small&quot; numbers.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>For species specific variables, you need to add the species name at the front, separated by a slash. For example, the proton bulk velocity is a string <code>proton/vg_v</code>.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>If a required variable exists in the VLSV file, we try to use it directly instead of calculating from other variables. The interpolated FS grid variables onto DCCRG grid are preferred over original FS grid variables.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>For Debian-based Linux distributions, it gets a little bit tricky. Please refer to <a href="https://pyjulia.readthedocs.io/en/latest/troubleshooting.html">Troubleshooting</a> for details.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../internal/">Internal »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 9 April 2021 09:42">Friday 9 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
